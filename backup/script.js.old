// ===================================
// RHYDLE WAITLIST - INTERACTIONS
// ===================================

// Header scroll effect
const header = document.getElementById('header');
let lastScroll = 0;

window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;

    if (currentScroll > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }

    lastScroll = currentScroll;
});

// FAQ Accordion
function toggleFaq(button) {
    const faqItem = button.closest('.faq-item');
    const isActive = faqItem.classList.contains('active');

    // Close all FAQ items
    document.querySelectorAll('.faq-item').forEach(item => {
        item.classList.remove('active');
    });

    // Open clicked item if it wasn't already active
    if (!isActive) {
        faqItem.classList.add('active');
    }
}

// Form submission handler
function handleSubmit(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);
    const email = formData.get('email');
    const projects = formData.get('projects');

    // Log form data (in production, send to your backend)
    console.log('Waitlist Signup:', {
        email,
        projects,
        timestamp: new Date().toISOString()
    });

    // Store in localStorage for demo
    const signups = JSON.parse(localStorage.getItem('waitlist_signups') || '[]');
    signups.push({
        email,
        projects,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('waitlist_signups', JSON.stringify(signups));

    // Show success modal
    showModal();

    // Reset form
    form.reset();

    // Track conversion (add your analytics code here)
    if (typeof gtag !== 'undefined') {
        gtag('event', 'conversion', {
            'send_to': 'AW-CONVERSION_ID/CONVERSION_LABEL',
            'value': 1.0,
            'currency': 'USD'
        });
    }
}

// Modal functions
function showModal() {
    const modal = document.getElementById('successModal');
    modal.classList.add('active');

    // Auto-close after 3 seconds
    setTimeout(() => {
        closeModal();
    }, 3000);
}

function closeModal() {
    const modal = document.getElementById('successModal');
    modal.classList.remove('active');
}

// Close modal on background click
document.getElementById('successModal').addEventListener('click', (e) => {
    if (e.target.id === 'successModal') {
        closeModal();
    }
});

// Intersection Observer for scroll animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -100px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate-on-scroll');
            observer.unobserve(entry.target);
        }
    });
}, observerOptions);

// Observe sections for animations
document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
        observer.observe(section);
    });

    // Animate problem cards
    const problemCards = document.querySelectorAll('.problem-card');
    problemCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        observer.observe(card);
    });

    // Animate feature sections
    const features = document.querySelectorAll('.feature');
    features.forEach((feature, index) => {
        feature.style.animationDelay = `${index * 0.15}s`;
        observer.observe(feature);
    });

    // Animate bars on scroll
    const bars = document.querySelectorAll('.bar');
    bars.forEach(bar => {
        const barObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.width = entry.target.style.getPropertyValue('--value');
                    barObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        // Reset width for animation
        const originalWidth = bar.style.getPropertyValue('--value');
        bar.style.width = '0';
        bar.style.setProperty('--value', originalWidth);

        barObserver.observe(bar);
    });
});

// Keyboard navigation for FAQ
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        // Close all FAQ items
        document.querySelectorAll('.faq-item.active').forEach(item => {
            item.classList.remove('active');
        });

        // Close modal
        closeModal();
    }
});

// Form validation enhancement
document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('blur', () => {
        if (input.value && input.validity.valid) {
            input.style.borderColor = 'var(--success)';
        } else if (input.value && !input.validity.valid) {
            input.style.borderColor = 'var(--error)';
        }
    });

    input.addEventListener('focus', () => {
        input.style.borderColor = 'var(--accent)';
    });
});

// Prevent form double submission
let isSubmitting = false;

document.querySelectorAll('.waitlist-form').forEach(form => {
    form.addEventListener('submit', (e) => {
        if (isSubmitting) {
            e.preventDefault();
            return;
        }

        isSubmitting = true;

        // Re-enable after 2 seconds
        setTimeout(() => {
            isSubmitting = false;
        }, 2000);
    });
});

// Add smooth scroll to anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Performance: Lazy load images (if you add images later)
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.classList.add('loaded');
                imageObserver.unobserve(img);
            }
        });
    });

    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });
}

// Analytics helper (ready for Google Analytics, Plausible, etc.)
function trackEvent(eventName, eventData = {}) {
    // Google Analytics 4
    if (typeof gtag !== 'undefined') {
        gtag('event', eventName, eventData);
    }

    // Plausible
    if (typeof plausible !== 'undefined') {
        plausible(eventName, { props: eventData });
    }

    // Console log for debugging
    console.log('Event tracked:', eventName, eventData);
}

// Track CTA clicks
document.querySelectorAll('.btn-primary, .btn-secondary').forEach(button => {
    button.addEventListener('click', () => {
        const buttonText = button.textContent.trim();
        trackEvent('cta_click', {
            button_text: buttonText,
            location: button.closest('section')?.className || 'unknown'
        });
    });
});

// Track FAQ interactions
document.querySelectorAll('.faq-question').forEach(button => {
    button.addEventListener('click', () => {
        const question = button.querySelector('span').textContent;
        trackEvent('faq_click', {
            question: question
        });
    });
});

// Track time on page
let startTime = Date.now();

window.addEventListener('beforeunload', () => {
    const timeSpent = Math.round((Date.now() - startTime) / 1000);
    trackEvent('time_on_page', {
        seconds: timeSpent
    });
});

// Console welcome message
console.log('%cðŸš€ RHYDLE', 'font-size: 24px; font-weight: bold; color: #FF6B2C;');
console.log('%cTrack. Analyze. Optimize.', 'font-size: 14px; color: #666;');
console.log('%cInterested in our tech stack? Check out our docs!', 'font-size: 12px; color: #999;');
